<!DOCTYPE html>
<html>

<head>
    <title>–¢–µ—Å—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</title>
</head>

<body>
    <h1>–¢–µ—Å—Ç RSA —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</h1>
    <button onclick="runTest()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
    <div id="result"></div>
    <input id="inp">
    <script src="static\js\appCrypto.js"></script>
    <script>
        async function runTest(message) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>üîÑ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞...</p>';

            try {
                const message = document.getElementById("inp").value.trim();
                // –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
                resultDiv.innerHTML += '<p>üîê –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∫–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è...</p>';
                const keys = {
                        publicKey: "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnVgJ8pMSAQdaEn8B+o4smM8/c1f9Vy9KEr19H8wp3k3euRZjs+A6c6Or9KiHdOeMZgRkvq/x2RMdg3fpV7pU2Dv1xWIblm0PaSFynURvnPCJVf+xIvHGrNeQMugY4KI58GoNMGeB/ckFH0Gtq2b4Ry5FPSxbLlRFIXoMNZBxnkrRgkIpGkBi7Si3pOF2tBwSfAbIHU/Du94tIAda1+o2LHGevKAZYjTfT5xMcvHDT1HJu9mEy1QPcyt+59cgc0gmAq61NjnNEmj3ay0sgcPK+Cz0yBxkeZy71Z9aIE3KC6P6OjEzHjsIbyjGijAZrbWOY+GJ6ZBKzHsvq4S0AhmNwQIDAQAB",
                        privateKey: "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCdWAnykxIBB1oSfwH6jiyYzz9zV/1XL0oSvX0fzCneTd65FmOz4Dpzo6v0qId054xmBGS+r/HZEx2Dd+lXulTYO/XFYhuWbQ9pIXKdRG+c8IlV/7Ei8cas15Ay6Bjgojnwag0wZ4H9yQUfQa2rZvhHLkU9LFsuVEUhegw1kHGeStGCQikaQGLtKLek4Xa0HBJ8BsgdT8O73i0gB1rX6jYscZ68oBliNN9PnExy8cNPUcm72YTLVA9zK37n1yBzSCYCrrU2Oc0SaPdrLSyBw8r4LPTIHGR5nLvVn1ogTcoLo/o6MTMeOwhvKMaKMBmttY5j4YnpkErMey+rhLQCGY3BAgMBAAECggEAIXI0cx72JcfVSrc6yXLtYfI0D6W1kZHY0hD7hwXUJJAy9u8edH8GjcxN4izs1lneC1WFwM8PvtAEZwzXSjGulWRxguqu6JP4QaW9glaozxiGaQR4N/BjBhywZ1HU7/MsE8HHWfG2vSa88v74FsZFooPgbfd+zmNVap9R9xTkQfxZ+qvRFDthib8D9e7qKZ1oHd3oIOGMsVitBRkL+yV6i+6iXEIC7aJd3K8mjLGRzi0c+uOPImretVdEPSQuZwZH/Wrz1YgN7633svKS28INTP8Cehcx07S/7E4HVvyJEKkE0PiJRPGchpc0MS63u0e981to3RMrhn0TxHxgqfr3LQKBgQDV94CIdYcq9G77YO01wtVl1dCb13O8jaI/8yrGK35IVrGPPRvFOoSzVTvqVQSh9HXKtuOitvfUTbUpu/u1yvFeMdr1qWQQF996LpVWnljHvFugT9YLXvB8TcyqSyNn8w4WX8cc2JWEzC9UFBvh7YvsezW7HpUsQ0TgN4p2VdKGrwKBgQC8QPFM2MG2dAUs6bqWTxhML+eYlit1Sw9Io157M1A92yr8m/mVmXf8gttfFnHofCifVYMfcDkl/cnONVmUBNBzG0n1T2xlkUxAoh33sdJzn0Ox/CFzM0lV4Aewybgsc7r28kKlp0N31dhM3+jepOIuZMvaGpFoajf6V5Ve6LlOjwKBgGyy9htdCbQqxY7zaM7dEihP/VCOnf92PK0cTeirA9agJEhOlSMXXX71mCCt3FKirIy1aOOq7DBw4c437+IlHYXq8f/HdEwwtJmPvNJqU1P1Pt8sb+MK8kVUCNuinHQcqFV5huACr8LtMEYYiSm30lPrLBrJqKL58a2uyargYrmFAoGARfWQdvF6k7ZsEfPOPnuoWO/YjnEIN2+sf18PBpPcNxCS2guQ5hKBb5qlsaGitTYm1oet0eofosm8zGAxKPvdB1nV008vxlMH1mEo59ryjbtbKfK775bYoww9b2qXghWEHq+LKwqM3STgXDk9zjfSQlF9HFGRRg9rPCJ+RSYRb2sCgYEAt/Vjka7/V7e40KoMwhNGv+Z8qGxqU+Q4OkeZGYsMD/KW6hUnQmbgaRaLAuhVX6iWTwXDhe/1QWKDTTnBpoRZCwHrcghlh0I/WWnAxurAb3w5ZaZgmmw6gSSw2rL6k89hsJ25QHYTKT5OZbMK1XSXWEPq2AqFLeA84W2KMBjcdEQ="
                    } //await generateEncryptionKeyPair();
                console.log(keys)
                resultDiv.innerHTML += `<p>‚úÖ –ö–ª—é—á–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã (–ø—É–±–ª–∏—á–Ω—ã–π: ${keys.publicKey.length} —Å–∏–º–≤–æ–ª–æ–≤)</p>`;

                // –®–∞–≥ 2: –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const originalMessage = message
                resultDiv.innerHTML += `<p>üìù –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "${originalMessage}"</p>`;

                // –®–∞–≥ 3: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
                resultDiv.innerHTML += '<p>üîí –®–∏—Ñ—Ä—É—é —Å–æ–æ–±—â–µ–Ω–∏–µ...</p>';
                const encrypted = await encryptMessage(message, keys.publicKey);
                resultDiv.innerHTML += `<p>‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ (${encrypted.length} —Å–∏–º–≤–æ–ª–æ–≤)</p>`;

                // –®–∞–≥ 4: –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
                resultDiv.innerHTML += '<p>üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—é —Å–æ–æ–±—â–µ–Ω–∏–µ...</p>';
                const decrypted = await decryptMessage(encrypted, keys.privateKey);
                resultDiv.innerHTML += `<p>‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ: "${decrypted}"</p>`;

                // –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞
                if (decrypted === originalMessage) {
                    resultDiv.innerHTML += '<p style="color: green; font-weight: bold;">üéâ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù –£–°–ü–ï–®–ù–û!</p>';
                } else {
                    resultDiv.innerHTML += '<p style="color: red; font-weight: bold;">‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç</p>';
                }

            } catch (error) {
                resultDiv.innerHTML += `<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
                console.error(error);
            }
        }
    </script>
</body>

</html>